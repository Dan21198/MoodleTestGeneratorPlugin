/**
 * Job processor for PDF Quiz Generator - Minified
 * @module local_pdfquizgen/job_processor
 */
define(["core/ajax","core/notification"],function(e,t){"use strict";var n=function(t,n){return e.call([{methodname:"local_pdfquizgen_process_job",args:{jobid:t,courseid:n}}])[0]},a=function(t){return e.call([{methodname:"local_pdfquizgen_get_job_status",args:{jobid:t}}])[0]},s=function(e,t){var n=document.querySelector('[data-stat="'+e+'"]');if(n){var a=parseInt(n.textContent,10)||0;n.textContent=Math.max(0,a+t)}},o=function(e,a,o){var r=o.querySelector(".job-status-badge"),i=o.querySelector(".job-actions");r&&(r.className="badge badge-info job-status-badge",r.textContent="Processing..."),i&&(i.innerHTML='<span class="spinner-border spinner-border-sm" role="status"></span> Processing...'),n(e,a).then(function(e){e.success?(r&&(r.className="badge badge-success job-status-badge",r.textContent="Completed"),i&&e.quizurl&&(i.innerHTML='<a href="'+e.quizurl+'" class="btn btn-sm btn-success"><i class="fa fa-eye"></i> View Quiz</a>'),s("pending",-1),s("completed",1),o.removeAttribute("data-pending-job")):(r&&(r.className="badge badge-danger job-status-badge",r.textContent="Failed"),i&&(i.innerHTML='<span class="text-danger" title="'+(e.error||"Unknown error")+'"><i class="fa fa-exclamation-triangle"></i> Error</span>'),s("pending",-1),s("failed",1))}).catch(function(e){t.exception(e),r&&(r.className="badge badge-danger job-status-badge",r.textContent="Error"),i&&(i.innerHTML='<span class="text-danger"><i class="fa fa-exclamation-triangle"></i> Network Error</span>'),s("pending",-1),s("failed",1)})};return{init:function(e){document.querySelectorAll("[data-pending-job]").forEach(function(t){var n=parseInt(t.dataset.pendingJob,10);n&&o(n,e,t)})},processJob:n,getJobStatus:a}});
